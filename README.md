# Benchmarking JVM model classes

This is a quick study of the relative performance and size of the typical DTO methods generated by:

* Groovy 2.4.5 annotations
* Scala 2.11.8 case classes
* Kotlin 1.0.0-beta-1038 data classes, with a lazy implementation that caches the hash (in lieu of https://youtrack.jetbrains.com/issue/KT-5196)
* Lombok 1.16.6 and AutoValue 1.1 annotation generated classes
* Eclipse and IntelliJ auto-generated classes
* Guava recommendations

## Notes

* Caching `hashCode()` values for immutable classes is an important optimisation, that can't be inferred and needs to be manually implemented
* We also don't consider the quality of the `hashCode()` implementation. They may take the same time, but result in poor hash distribution

# Running

To run locally:

* Benchmarks - `./gradlew jmh` (it should take about 30 minutes and the results will be in ./build/reports/jmh/human.txt)
* Memory - `./gradlew measureMemory`

# Benchmarks

    # JMH 1.11.1 (released 28 days ago)
    # VM version: JDK 1.8.0_60, VM 25.60-b23
    # VM invoker: /Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/jre/bin/java
    # VM options: -Dfile.encoding=UTF-8 -Duser.country=US -Duser.language=en -Duser.variant
    # Warmup: 15 iterations, 1 s each
    # Measurement: 30 iterations, 1 s each
    # Threads: 1 thread, will synchronize iterations
    # Benchmark mode: Average time, time/op

    Model Name: MacBook Pro
    Model Identifier: MacBookPro11,2
    Processor Name: Intel Core i7
    Processor Speed: 2.8 GHz
    Number of Processors: 1
    Total Number of Cores: 4
    L2 Cache (per Core): 256 KB
    L3 Cache: 6 MB
    Memory: 16 GB

## Object instantiation

    Benchmark                            (model)  Mode  Cnt     Score    Error  Units
    ModelBenchmark.create               intellij  avgt   30    24.593 ±   0.152  ns/op
    ModelBenchmark.create                eclipse  avgt   30    23.818 ±   0.168  ns/op
    ModelBenchmark.create                 groovy  avgt   30    30.092 ±   0.163  ns/op
    ModelBenchmark.create           groovystatic  avgt   30    29.435 ±   0.151  ns/op
    ModelBenchmark.create                 lombok  avgt   30    23.639 ±   0.141  ns/op
    ModelBenchmark.create                  scala  avgt   30    27.784 ±   0.125  ns/op
    ModelBenchmark.create                 kotlin  avgt   30    22.290 ±   0.157  ns/op
    ModelBenchmark.create             kotlinlazy  avgt   30    33.798 ±   0.210  ns/op
    ModelBenchmark.create              autovalue  avgt   30    25.346 ±   0.212  ns/op
    ModelBenchmark.create                  guava  avgt   30    24.038 ±   0.151  ns/op

## equals()

Equals against the same model instance:

    Benchmark                            (model)  Mode  Cnt     Score     Error  Units
    ModelBenchmark.equalsIdentity       intellij  avgt   30     3.852 ±   0.027  ns/op
    ModelBenchmark.equalsIdentity        eclipse  avgt   30     2.376 ±   0.013  ns/op
    ModelBenchmark.equalsIdentity         groovy  avgt   30     6.821 ±   0.040  ns/op
    ModelBenchmark.equalsIdentity   groovystatic  avgt   30     2.373 ±   0.011  ns/op
    ModelBenchmark.equalsIdentity         lombok  avgt   30     3.865 ±   0.024  ns/op
    ModelBenchmark.equalsIdentity          scala  avgt   30     2.373 ±   0.010  ns/op
    ModelBenchmark.equalsIdentity         kotlin  avgt   30     2.370 ±   0.013  ns/op
    ModelBenchmark.equalsIdentity     kotlinlazy  avgt   30     2.378 ±   0.012  ns/op
    ModelBenchmark.equalsIdentity      autovalue  avgt   30     2.386 ±   0.032  ns/op
    ModelBenchmark.equalsIdentity          guava  avgt   30     2.381 ±   0.030  ns/op

Equals null:

    Benchmark                            (model)  Mode  Cnt     Score     Error  Units
    ModelBenchmark.equalsNull           intellij  avgt   30     3.844 ±   0.023  ns/op
    ModelBenchmark.equalsNull            eclipse  avgt   30     2.365 ±   0.011  ns/op
    ModelBenchmark.equalsNull             groovy  avgt   30     3.804 ±   0.026  ns/op
    ModelBenchmark.equalsNull       groovystatic  avgt   30     2.365 ±   0.013  ns/op
    ModelBenchmark.equalsNull             lombok  avgt   30     3.844 ±   0.024  ns/op
    ModelBenchmark.equalsNull              scala  avgt   30     2.377 ±   0.032  ns/op
    ModelBenchmark.equalsNull             kotlin  avgt   30     2.388 ±   0.027  ns/op
    ModelBenchmark.equalsNull         kotlinlazy  avgt   30     2.394 ±   0.028  ns/op
    ModelBenchmark.equalsNull          autovalue  avgt   30     2.377 ±   0.030  ns/op
    ModelBenchmark.equalsNull              guava  avgt   30     2.379 ±   0.021  ns/op

Equals against an instance with a different type:

    Benchmark                            (model)  Mode  Cnt     Score     Error  Units
    ModelBenchmark.equalsOtherType      intellij  avgt   30     4.193 ±   0.029  ns/op
    ModelBenchmark.equalsOtherType       eclipse  avgt   30     3.337 ±   0.111  ns/op
    ModelBenchmark.equalsOtherType        groovy  avgt   30     7.075 ±   0.107  ns/op
    ModelBenchmark.equalsOtherType  groovystatic  avgt   30     3.137 ±   0.017  ns/op
    ModelBenchmark.equalsOtherType        lombok  avgt   30     4.317 ±   0.030  ns/op
    ModelBenchmark.equalsOtherType         scala  avgt   30     3.210 ±   0.115  ns/op
    ModelBenchmark.equalsOtherType        kotlin  avgt   30     3.248 ±   0.050  ns/op
    ModelBenchmark.equalsOtherType    kotlinlazy  avgt   30     3.197 ±   0.049  ns/op
    ModelBenchmark.equalsOtherType     autovalue  avgt   30     3.521 ±   0.068  ns/op
    ModelBenchmark.equalsOtherType         guava  avgt   30     3.129 ±   0.019  ns/op

Equals against an equal, but different instance:

    Benchmark                            (model)  Mode  Cnt     Score     Error  Units
    ModelBenchmark.equalsWorstCase      intellij  avgt   30    28.852 ±   1.903  ns/op
    ModelBenchmark.equalsWorstCase       eclipse  avgt   30    32.640 ±   3.498  ns/op
    ModelBenchmark.equalsWorstCase        groovy  avgt   30    65.681 ±   5.770  ns/op
    ModelBenchmark.equalsWorstCase  groovystatic  avgt   30    60.444 ±   2.295  ns/op
    ModelBenchmark.equalsWorstCase        lombok  avgt   30    35.995 ±   1.087  ns/op
    ModelBenchmark.equalsWorstCase         scala  avgt   30    27.623 ±   2.514  ns/op
    ModelBenchmark.equalsWorstCase        kotlin  avgt   30    84.030 ±  15.763  ns/op
    ModelBenchmark.equalsWorstCase    kotlinlazy  avgt   30    65.902 ±   0.704  ns/op
    ModelBenchmark.equalsWorstCase     autovalue  avgt   30    21.774 ±   1.333  ns/op
    ModelBenchmark.equalsWorstCase         guava  avgt   30   117.041 ±   8.073  ns/op

## firstHashCode()

Allows comparison of expense of lazy initialisation of hashCode for lazy classes. Includes object creation overhead.

    Benchmark                            (model)  Mode  Cnt     Score     Error  Units
    ModelBenchmark.firstHashCode        intellij  avgt   30    83.722 ±  20.511  ns/op
    ModelBenchmark.firstHashCode         eclipse  avgt   30    45.636 ±   0.279  ns/op
    ModelBenchmark.firstHashCode          groovy  avgt   30   174.447 ±   0.580  ns/op
    ModelBenchmark.firstHashCode    groovystatic  avgt   30  3887.561 ± 219.875  ns/op
    ModelBenchmark.firstHashCode          lombok  avgt   30    44.019 ±   1.494  ns/op
    ModelBenchmark.firstHashCode           scala  avgt   30   147.650 ±  29.696  ns/op
    ModelBenchmark.firstHashCode          kotlin  avgt   30    55.645 ±  19.007  ns/op
    ModelBenchmark.firstHashCode      kotlinlazy  avgt   30    98.480 ±   4.027  ns/op
    ModelBenchmark.firstHashCode       autovalue  avgt   30    46.362 ±   2.225  ns/op
    ModelBenchmark.firstHashCode           guava  avgt   30    84.607 ±   1.704  ns/op

## hashCode()

    Benchmark                            (model)  Mode  Cnt     Score     Error  Units
    ModelBenchmark.hashCode             intellij  avgt   30    23.425 ±   0.195  ns/op
    ModelBenchmark.hashCode              eclipse  avgt   30    23.948 ±   0.208  ns/op
    ModelBenchmark.hashCode               groovy  avgt   30   130.400 ±   3.738  ns/op
    ModelBenchmark.hashCode         groovystatic  avgt   30  3175.860 ±  58.442  ns/op
    ModelBenchmark.hashCode               lombok  avgt   30    21.738 ±   0.223  ns/op
    ModelBenchmark.hashCode                scala  avgt   30    38.975 ±   0.362  ns/op
    ModelBenchmark.hashCode               kotlin  avgt   30    22.067 ±   0.186  ns/op
    ModelBenchmark.hashCode           kotlinlazy  avgt   30    3.270  ±   0.056  ns/op
    ModelBenchmark.hashCode            autovalue  avgt   30    21.351 ±   0.196  ns/op
    ModelBenchmark.hashCode                guava  avgt   30    63.798 ±   0.686  ns/op

## toString()

    Benchmark                            (model)  Mode  Cnt     Score    Error  Units
    ModelBenchmark.toString             intellij  avgt   30   314.430 ±   4.522  ns/op
    ModelBenchmark.toString              eclipse  avgt   30   310.843 ±   6.039  ns/op
    ModelBenchmark.toString               groovy  avgt   30  1598.653 ±  15.425  ns/op
    ModelBenchmark.toString         groovystatic  avgt   30  1405.084 ±  15.053  ns/op
    ModelBenchmark.toString               lombok  avgt   30   310.367 ±   4.737  ns/op
    ModelBenchmark.toString                scala  avgt   30   547.054 ±   5.972  ns/op
    ModelBenchmark.toString               kotlin  avgt   30   287.187 ±   5.059  ns/op
    ModelBenchmark.toString           kotlinlazy  avgt   30   322.208 ±   5.315  ns/op
    ModelBenchmark.toString            autovalue  avgt   30   336.290 ±   4.930  ns/op
    ModelBenchmark.toString                guava  avgt   30   508.504 ±  88.204  ns/op

# Memory

    intellij : 440 bytes, Footprint{Objects=17, References=21, Primitives=[double, char x 6, int x 8]}
    eclipse : 440 bytes, Footprint{Objects=17, References=21, Primitives=[double, char x 6, int x 8]}
    groovy : 448 bytes, Footprint{Objects=17, References=22, Primitives=[double, char x 6, int x 8]}
    groovystatic : 448 bytes, Footprint{Objects=17, References=22, Primitives=[double, char x 6, int x 8]}
    lombok : 440 bytes, Footprint{Objects=17, References=21, Primitives=[double, char x 6, int x 8]}
    scala : 520 bytes, Footprint{Objects=17, References=39, Primitives=[double, char x 6, int x 8]}
    kotlin : 408 bytes, Footprint{Objects=15, References=19, Primitives=[double, char x 6, int x 8]}
    autovalue : 440 bytes, Footprint{Objects=17, References=21, Primitives=[double, char x 6, int x 8]}
    guava : 440 bytes, Footprint{Objects=17, References=21, Primitives=[double, char x 6, int x 8]}

Note: `metaClass` reference is excluded for Groovy.
